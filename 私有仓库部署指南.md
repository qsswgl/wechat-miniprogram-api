# ç§æœ‰Dockerä»“åº“éƒ¨ç½²æŒ‡å—

## ğŸ³ .NET 8ç‹¬ç«‹éƒ¨ç½²åˆ°ç§æœ‰ä»“åº“ 43.138.35.183

### ğŸ“‹ é¡¹ç›®é…ç½®

å·²é…ç½®ä¸º.NET 8ç‹¬ç«‹éƒ¨ç½²æ¨¡å¼ï¼š
- âœ… **SelfContained**: true (åŒ…å«æ‰€æœ‰è¿è¡Œæ—¶ä¾èµ–)
- âœ… **PublishTrimmed**: true (å‡å°é•œåƒå¤§å°)
- âœ… **PublishSingleFile**: true (å•æ–‡ä»¶éƒ¨ç½²)
- âœ… **RuntimeIdentifier**: linux-x64

### ğŸ”§ Dockeré…ç½®

#### 1. é…ç½®ç§æœ‰ä»“åº“

å¦‚æœç§æœ‰ä»“åº“ä½¿ç”¨HTTP (éHTTPS)ï¼Œéœ€è¦é…ç½®Dockerå…è®¸ä¸å®‰å…¨è¿æ¥ï¼š

**Windows (Docker Desktop)**:
1. æ‰“å¼€Docker Desktopè®¾ç½®
2. è¿›å…¥ "Docker Engine" é…ç½®
3. æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š
```json
{
  "insecure-registries": ["43.138.35.183:5000"]
}
```

**Linux**:
ç¼–è¾‘ `/etc/docker/daemon.json`:
```json
{
  "insecure-registries": ["43.138.35.183:5000"]
}
```

é‡å¯DockeræœåŠ¡ï¼š
```bash
sudo systemctl restart docker
```

#### 2. æ„å»ºå’Œæ¨é€å‘½ä»¤

```cmd
# è‡ªåŠ¨åŒ–æ„å»ºæ¨é€
build-and-push-private.bat

# æ‰‹åŠ¨æ„å»ºæ¨é€
docker build -f Dockerfile.net8 -t 43.138.35.183:5000/wechat-api-net8:latest .
docker push 43.138.35.183:5000/wechat-api-net8:latest
```

### ğŸš€ éƒ¨ç½²åˆ°ç›®æ ‡æœåŠ¡å™¨

#### åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šè¿è¡Œ

```bash
# æ‹‰å–é•œåƒ
docker pull 43.138.35.183:5000/wechat-api-net8:latest

# è¿è¡Œå®¹å™¨
docker run -d \
  --name wechat-api \
  -p 8080:8080 \
  -v $(pwd)/uploadall:/app/wwwroot/uploadall \
  --restart unless-stopped \
  43.138.35.183:5000/wechat-api-net8:latest

# æ£€æŸ¥çŠ¶æ€
docker ps
docker logs wechat-api
```

#### è®¿é—®åº”ç”¨

- **APIæ–‡æ¡£**: http://æœåŠ¡å™¨IP:8080/swagger
- **å¥åº·æ£€æŸ¥**: http://æœåŠ¡å™¨IP:8080/health
- **APIæ¥å£**: http://æœåŠ¡å™¨IP:8080/api/wechat/

### ğŸ“Š ç‹¬ç«‹éƒ¨ç½²ä¼˜åŠ¿

1. **æ— éœ€å®‰è£….NETè¿è¡Œæ—¶**: é•œåƒåŒ…å«æ‰€æœ‰ä¾èµ–
2. **æ›´å°çš„åŸºç¡€é•œåƒ**: ä½¿ç”¨Ubuntuè€Œé.NETè¿è¡Œæ—¶é•œåƒ
3. **æ›´å¿«çš„å¯åŠ¨**: ç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶
4. **æ›´å¥½çš„å®‰å…¨æ€§**: érootç”¨æˆ·è¿è¡Œ
5. **è·¨å¹³å°å…¼å®¹**: linux-x64è¿è¡Œæ—¶

### ğŸ” æ•…éšœæ’é™¤

#### æ¨é€å¤±è´¥

```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping 43.138.35.183

# æ£€æŸ¥ç«¯å£è¿é€šæ€§
telnet 43.138.35.183 5000

# å¦‚éœ€è®¤è¯
docker login 43.138.35.183:5000
```

#### å®¹å™¨å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker logs --details wechat-api

# è¿›å…¥å®¹å™¨è°ƒè¯•
docker run -it --rm 43.138.35.183:5000/wechat-api-net8:latest /bin/bash

# æ£€æŸ¥æ–‡ä»¶æƒé™
docker run -it --rm 43.138.35.183:5000/wechat-api-net8:latest ls -la
```

### ğŸ“ é•œåƒä¿¡æ¯

- **åŸºç¡€é•œåƒ**: Ubuntu 22.04
- **åº”ç”¨ç±»å‹**: .NET 8 ç‹¬ç«‹éƒ¨ç½²
- **è¿è¡Œç”¨æˆ·**: appuser (éroot)
- **æš´éœ²ç«¯å£**: 8080 (HTTP)
- **å·¥ä½œç›®å½•**: /app
- **å¯æ‰§è¡Œæ–‡ä»¶**: ./WeChatMiniProgramAPI

### ğŸ”„ æ›´æ–°éƒ¨ç½²

```bash
# åœæ­¢ç°æœ‰å®¹å™¨
docker stop wechat-api
docker rm wechat-api

# æ‹‰å–æœ€æ–°é•œåƒ
docker pull 43.138.35.183:5000/wechat-api-net8:latest

# é‡æ–°å¯åŠ¨
docker run -d --name wechat-api -p 8080:8080 43.138.35.183:5000/wechat-api-net8:latest
```

---

ä½¿ç”¨ `build-and-push-private.bat` ä¸€é”®æ„å»ºå¹¶æ¨é€åˆ°ç§æœ‰ä»“åº“ï¼
